
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- This HTML was auto-generated from MATLAB code. To make changes, update the MATLAB code and republish this document.       --><title>生存データまたは信頼性データの分析</title><meta name="generator" content="MATLAB 7.14"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2011-11-14"><meta name="DC.source" content="survivaldemo.m"><link rel="stylesheet" type="text/css" href="../../../../matlab/helptools/private/style.css"><link rel="stylesheet" type="text/css" href="../../../../matlab/helptools/private/style_ja_JP.css"></head><body><div class="header"><div class="left"><a href="matlab:edit survivaldemo">エディターで survivaldemo.m を開く</a></div><div class="right"><a href="matlab:echodemo survivaldemo">コマンド ウィンドウで実行</a></div></div><div class="content"><h1>生存データまたは信頼性データの分析</h1><!--introduction--><p>このデモでは、寿命データの分析を検討します。生物学的応用または医学的応用では、この分析は生存分析として知られており、時間が、生物の生存時間、または病気が治癒するまでの時間を表すことがあります。工学的応用では、この分析は信頼性分析として知られており、時間が、装置の故障までの時間を表すことがあります。</p><p>MATLAB&reg; と Statistics Toolbox™ を使用して寿命データを分析する方法を示すために、自動車の燃料噴射システムのスロットルが故障するまでの時間をモデル化する際の応用を調べます。</p><!--/introduction--><h2>目次</h2><div><ul><li><a href="#1">寿命データの特徴</a></li><li><a href="#4">分布を調べる方法</a></li><li><a href="#5">ワイブル分布の近似</a></li><li><a href="#9">滑らかなノンパラメトリック推定の追加</a></li><li><a href="#12">代替モデル</a></li></ul></div><h2>寿命データの特徴<a name="1"></a></h2><p>寿命データには、他のタイプのデータにはない、際立った特徴があります。第 1 に、寿命データの値は常に正であり、通常は時間を表します。第 2 に、寿命データの中には、正確に観測されず、一部の値よりも大きいことのみがわかるようなデータがあります。第 3 の特徴は、よく使用される分布と分析方法が寿命データに特化したものであるということです。</p><p>100 個のスロットルを故障するまでテストした結果のシミュレーションを実行してみましょう。ほとんどのスロットルは寿命がかなり長く、少数のスロットルは非常に早く故障する傾向があった場合に観測されるデータを生成します。</p><pre class="codeinput">rng(2,<span class="string">'twister'</span>);
lifetime = [wblrnd(15000,3,90,1); wblrnd(1500,3,10,1)];
</pre><p>この例では、現場で実際に 100 時間使用した状況を各テスト時間で再現できるように、厳しい条件下でスロットルをテストすると仮定します。実践的な理由から、多くの場合、信頼性テストは一定の時間が経過すると停止されます。この例では、140 時間を採用します。これは、実際の稼働時間が 14,000 時間に達した状況に相当します。テスト中に故障するものもあれば、140 時間故障しないものもあります。実際のテストでは、後者の時間は 14,000 として記録されます。これを、シミュレートされたデータで再現します。また、故障時間を並べ替えることもよく行われます。</p><pre class="codeinput">T = 14000;
obstime = sort(min(T, lifetime));
</pre><p>テストで故障しなかったスロットルもいずれは故障することはわかっていますが、実際の故障時間を観測できるほどテスト期間は長くありません。このテストから判断できるのは、それらのスロットルの寿命が 14,000 時間以上であることのみです。このような値を、打ち切られた値と呼びます。次のプロットは、データの約 40% が 14,000 で打ち切られていることを示しています。</p><pre class="codeinput">failed = obstime(obstime&lt;T); nfailed = length(failed);
survived = obstime(obstime==T); nsurvived = length(survived);
censored = (obstime &gt;= T);
plot([zeros(size(obstime)),obstime]', repmat(1:length(obstime),2,1), <span class="keyword">...</span>
     <span class="string">'Color'</span>,<span class="string">'b'</span>,<span class="string">'LineStyle'</span>,<span class="string">'-'</span>)
line([T;3e4], repmat(nfailed+(1:nsurvived), 2, 1), <span class="string">'Color'</span>,<span class="string">'b'</span>,<span class="string">'LineStyle'</span>,<span class="string">':'</span>);
line([T;T], [0;nfailed+nsurvived],<span class="string">'Color'</span>,<span class="string">'k'</span>,<span class="string">'LineStyle'</span>,<span class="string">'-'</span>)
text(T,30,<span class="string">'&lt;--Unknown survival time past here'</span>)
xlabel(<span class="string">'Survival time'</span>); ylabel(<span class="string">'Observation number'</span>)
</pre><img vspace="5" hspace="5" src="../survivaldemo_01.png" alt=""> <h2>分布を調べる方法<a name="4"></a></h2><p>データの分布を観察する前に、確率分布を調べるさまざまな方法を検討してみましょう。</p><div><ul><li>確率密度関数 (PDF) は、さまざまな時間における故障の相対的確率を示します。</li><li>生存関数は生存の確率を時間の関数として与えますが、単に 1 から累積分布関数を引いたもの (1-CDF) にすぎません。</li><li>ハザード率は、所定の時間までの生存が与えられている場合の瞬間故障率を与えます。これは、PDF を生存関数で除算したものです。この例では、ハザード率が上昇していることがわかります。これは、時間が経過するにつれて故障しやすくなること (経年劣化) を意味しています。</li><li>確率プロットは再スケーリングされた CDFであり、データを近似分布と比較するために使用します。</li></ul></div><p>ワイブル分布を使用した、これら 4 つのプロット タイプの例を以下に示しています。ワイブル分布は、寿命データのモデル化によく使用されています。</p><pre class="codeinput">x = linspace(1,30000);
subplot(2,2,1);
plot(x,wblpdf(x,14000,2),x,wblpdf(x,18000,2),x,wblpdf(x,14000,1.1))
title(<span class="string">'Prob. Density Fcn'</span>)
subplot(2,2,2);
plot(x,1-wblcdf(x,14000,2),x,1-wblcdf(x,18000,2),x,1-wblcdf(x,14000,1.1))
title(<span class="string">'Survivor Fcn'</span>)
subplot(2,2,3);
wblhaz = @(x,a,b) (wblpdf(x,a,b) ./ (1-wblcdf(x,a,b)));
plot(x,wblhaz(x,14000,2),x,wblhaz(x,18000,2),x,wblhaz(x,14000,1.1))
title(<span class="string">'Hazard Rate Fcn'</span>)
subplot(2,2,4);
probplot(<span class="string">'weibull'</span>,wblrnd(14000,2,40,1))
title(<span class="string">'Probability Plot'</span>)
</pre><img vspace="5" hspace="5" src="../survivaldemo_02.png" alt=""> <h2>ワイブル分布の近似<a name="5"></a></h2><p>ワイブル分布は、指数分布を一般化したものです。寿命が指数分布に従う場合、寿命のハザード率は一定です。これは、寿命が経年変化しないことを意味します。つまり、ある区間において故障が観測される確率は、その区間の開始までの生存が与えられていれば、区間がどこで始まろうが関係ない、ということを意味します。ワイブル分布では、ハザード率が増減することがあります。</p><p>寿命データのモデル化に使用される他の分布として、対数正規分布、ガンマ分布、および Birnbaum-Saunders 分布が挙げられます。</p><p>可能な各生存時間までに故障する割合を示す、データの経験累積分布関数をプロットします。点線の曲線によって、これらの確率の 95% 信頼区間が与えられます。</p><pre class="codeinput">subplot(1,1,1);
[empF,x,empFlo,empFup] = ecdf(obstime,<span class="string">'censoring'</span>,censored);
stairs(x,empF);
hold <span class="string">on</span>;
stairs(x,empFlo,<span class="string">':'</span>); stairs(x,empFup,<span class="string">':'</span>);
hold <span class="string">off</span>
xlabel(<span class="string">'Time'</span>); ylabel(<span class="string">'Proportion failed'</span>); title(<span class="string">'Empirical CDF'</span>)
</pre><img vspace="5" hspace="5" src="../survivaldemo_03.png" alt=""> <p>このプロットからわかるように、たとえば、4,000 時間までに故障する割合は約 12% であり、この時間までの故障確率の 95% 信頼限界は 6% ～ 18% です。テストは 14,000 時間しか実施されていないため、経験累積分布関数を使用して計算できるのは、その限度までの故障確率にすぎません。データの約半分が 14,000 で打ち切られているため、経験累積分布関数は、1.0 ではなく約 0.53 まで上がるだけです。</p><p>ワイブル分布は通常、装置故障に適したモデルです。関数 <tt>wblfit</tt> は、ワイブル分布をデータ (打ち切りを伴うデータを含む) に近似させます。パラメーター推定を計算した後、それらの推定を使用して近似ワイブル分布の累積分布関数を評価します。累積分布関数の値は推定されたパラメーターに基づくため、それらの信頼限界を計算します。</p><pre class="codeinput">paramEsts = wblfit(obstime,<span class="string">'censoring'</span>,censored);
[nlogl,paramCov] = wbllike(paramEsts,obstime,censored);
xx = linspace(1,2*T,500);
[wblF,wblFlo,wblFup] = wblcdf(xx,paramEsts(1),paramEsts(2),paramCov);
</pre><p>経験累積分布関数と近似累積分布関数のプロットを重ね合わせることができます。こうすることで、スロットルの信頼性データがワイブル分布によって、どの程度適切にモデル化されるかを判断できます。</p><pre class="codeinput">stairs(x,empF);
hold <span class="string">on</span>
handles = plot(xx,wblF,<span class="string">'r-'</span>,xx,wblFlo,<span class="string">'r:'</span>,xx,wblFup,<span class="string">'r:'</span>);
hold <span class="string">off</span>
xlabel(<span class="string">'Time'</span>); ylabel(<span class="string">'Fitted failure probability'</span>); title(<span class="string">'Weibull Model vs. Empirical'</span>)
</pre><img vspace="5" hspace="5" src="../survivaldemo_04.png" alt=""> <p>ワイブル モデルを使用すると、テストが終了した後の時間における故障確率を予想し、計算することができます。しかし、近似曲線がデータと十分に一致しないように思われます。2,000 時間より前の初期故障が、ワイブル モデルで予想されるよりもはるかに多く、その結果、約 7,000 ～ 約 13,000 時間における初期故障が非常に少なくなっています。これは驚くことではありません。この種の動作を伴うデータを生成したことを思い出してください。</p><h2>滑らかなノンパラメトリック推定の追加<a name="9"></a></h2><p>Statistics Toolbox に用意されている事前定義の関数には、このような過剰な初期故障がある分布は含まれていません。その代わり、関数 <tt>ksdensity</tt> を使用して、経験累積分布関数を介した滑らかなノンパラメトリック曲線を描画することができます。ワイブル累積分布関数の信頼帯を取り除き、2 つの曲線を追加します。一方の曲線は既定の平滑化パラメーターを使用したもので、他方の曲線は既定値の 1/3 の平滑化パラメーターを使用したものです。平滑化パラメーターが小さいほど、曲線がより密接にデータに追従します。</p><pre class="codeinput">delete(handles(2:end))
[npF,ignore,u] = ksdensity(obstime,xx,<span class="string">'cens'</span>,censored,<span class="string">'function'</span>,<span class="string">'cdf'</span>);
line(xx,npF,<span class="string">'Color'</span>,<span class="string">'g'</span>);
npF3 = ksdensity(obstime,xx,<span class="string">'cens'</span>,censored,<span class="string">'function'</span>,<span class="string">'cdf'</span>,<span class="string">'width'</span>,u/3);
line(xx,npF3,<span class="string">'Color'</span>,<span class="string">'m'</span>);
xlim([0 1.3*T])
title(<span class="string">'Weibull and Nonparametric Models vs. Empirical'</span>)
legend(<span class="string">'Empirical'</span>,<span class="string">'Fitted Weibull'</span>,<span class="string">'Nonparametric, default'</span>,<span class="string">'Nonparametric, 1/3 default'</span>, <span class="keyword">...</span>
       <span class="string">'location'</span>,<span class="string">'northwest'</span>);
</pre><img vspace="5" hspace="5" src="../survivaldemo_05.png" alt=""> <p>より小さい平滑化パラメーターを使用したノンパラメトリック推定は、十分にデータと一致します。しかし、経験累分布関数と同様に、テストが終了した後にノンパラメトリック モデルを外挿することは不可能です。つまり、推定された累積分布関数が、最後の観測の後は平坦になります。</p><p>このノンパラメトリック近似のハザード率を計算し、データの範囲全体にわたってプロットしてみましょう。</p><pre class="codeinput">hazrate = ksdensity(obstime,xx,<span class="string">'cens'</span>,censored,<span class="string">'width'</span>,u/3) ./ (1-npF3);
plot(xx,hazrate)
title(<span class="string">'Hazard Rate for Nonparametric Model'</span>)
xlim([0 T])
</pre><img vspace="5" hspace="5" src="../survivaldemo_06.png" alt=""> <p>この曲線は &quot;バスタブ&quot; のような形状をしており、ハザード率が 2,000 付近で高く、その後、低い値になり、次に再び上昇しています。これは、寿命の早期に故障しやすく (初期故障)、寿命の後期に再び故障しやすい (経年劣化) コンポーネントに典型的なハザード率です。</p><p>また、ノンパラメトリック モデルにおける打ち切られていない最大の観測を超えてハザード率を推定することはできず、グラフがゼロまで下がることに注意してください。</p><h2>代替モデル<a name="12"></a></h2><p>この例で使用した、シミュレートされたデータの場合、ワイブル分布は適切な近似ではないことがわかりました。ノンパラメトリック近似を使用すると、十分にデータを近似できましたが、そのモデルは、そのデータの範囲内でのみ役に立ちました。</p><p>代替方法は、異なるパラメトリック分布を使用するというものです。Statistics Toolbox には、対数正規分布、ガンマ分布、Birnbaum-Saunders 分布といった他の一般的な寿命分布向けの関数と、寿命モデルではあまり使用されない他の分布向けの関数が含まれています。また、<a href="customdist2demo.html">Cカスタム一変量分布の近似 (第 2 部)</a> のデモで説明されているように、カスタム パラメトリック モデルを定義して、寿命データに近似させることもできます。</p><p>さらに別の方法は、2 つのパラメトリック分布 (一方は初期故障を表し、他方は残りの分布を表す) を組み合わせて使用するというものです。この組み合わせの近似は、<a href="customdist1demo.html">カスタム一変量分布の近似</a> のデモに記載されています。</p><p class="footer">Copyright 2004-2007 The MathWorks, Inc.<br>Published with MATLAB&reg; 7.13</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!-- ##### SOURCE BEGIN ##### %% Analyzing Survival or Reliability Data % In this demo we consider the analysis of lifetime data.  In biological or % medical applications, this is known as survival analysis, and the times % may represent the survival time of an organism or the time until a % disease is cured.  In engineering applications, this is known as % reliability analysis, and the times may represent the time to failure of % a piece of equipment. % % To demonstrate how to use MATLAB(R) and the Statistics Toolbox(TM) to analyze % lifetime data, we'll look at an application in modeling the time to failure % of a throttle from an automobile fuel injection system.  %   Copyright 2004-2011 The MathWorks, Inc. %   $Revision: 1.1.6.6 $  $Date: 2012/02/14 03:55:48 $  %% Special Properties of Lifetime Data % Some features of lifetime data distinguish them other types of data. % First, the lifetimes are always positive values, usually representing % time.  Second, some lifetimes may not be observed exactly, so that they % are known only to be larger than some value.  Third, the distributions and % analysis techniques that are commonly used are fairly specific to % lifetime data % % Let's simulate the results of testing 100 throttles until failure.  We'll % generate data that might be observed if most throttles had a fairly long % lifetime, but a small percentage tended to fail very early. rng(2,'twister'); lifetime = [wblrnd(15000,3,90,1); wblrnd(1500,3,10,1)];  %% % In this example, assume that we are testing the throttles under stressful % conditions, so that each hour of testing is equivalent to 100 hours of % actual use in the field.  For pragmatic reasons, it's often the case that % reliability tests are stopped after a fixed amount of time.  For this % example, we will use 140 hours, equivalent to a total of 14,000 hours of % real service.  Some items fail during the test, while others survive the % entire 140 hours.  In a real test, the times for the latter would be % recorded as 14,000, and we mimic this in the simulated data.  It is also % common practice to sort the failure times. T = 14000; obstime = sort(min(T, lifetime));  %% % We know that any throttles that survive the test will fail eventually, % but the test is not long enough to observe their actual time to failure. % Their lifetimes are only known to be greater than 14,000 hours.  These % values are said to be censored.  This plot shows that about 40% of our % data are censored at 14,000. failed = obstime(obstime<T); nfailed = length(failed); survived = obstime(obstime==T); nsurvived = length(survived); censored = (obstime >= T); plot([zeros(size(obstime)),obstime]', repmat(1:length(obstime),2,1), ...      'Color','b','LineStyle','-') line([T;3e4], repmat(nfailed+(1:nsurvived), 2, 1), 'Color','b','LineStyle',':'); line([T;T], [0;nfailed+nsurvived],'Color','k','LineStyle','-') text(T,30,'<REPLACE_WITH_DASH_DASHUnknown survival time past here') xlabel('Survival time'); ylabel('Observation number')  %% Ways of Looking at Distributions % Before we examine the distribution of the data, let's consider different % ways of looking at a probability distribution. % % * A probability density function (PDF) indicates the relative probability %   of failure at different times. % * A survivor function gives the probability of survival as a %   function of time, and is simply one minus the cumulative distribution %   function (1-CDF). % * The hazard rate gives the instantaneous probability of failure %   given survival to a given time.  It is the PDF divided by the survivor %   function.  In this example the hazard rates turn out to be increasing, %   meaning the items are more susceptible to failure as time passes %   (aging). % * A probability plot is a re-scaled CDF, and is used to compare data %   to a fitted distribution. % % Here are examples of those four plot types, using the Weibull % distribution to illustrate.  The Weibull is a common distribution for % modeling lifetime data. x = linspace(1,30000); subplot(2,2,1); plot(x,wblpdf(x,14000,2),x,wblpdf(x,18000,2),x,wblpdf(x,14000,1.1)) title('Prob. Density Fcn') subplot(2,2,2); plot(x,1-wblcdf(x,14000,2),x,1-wblcdf(x,18000,2),x,1-wblcdf(x,14000,1.1)) title('Survivor Fcn') subplot(2,2,3); wblhaz = @(x,a,b) (wblpdf(x,a,b) ./ (1-wblcdf(x,a,b))); plot(x,wblhaz(x,14000,2),x,wblhaz(x,18000,2),x,wblhaz(x,14000,1.1)) title('Hazard Rate Fcn') subplot(2,2,4); probplot('weibull',wblrnd(14000,2,40,1)) title('Probability Plot')  %% Fitting a Weibull Distribution % The Weibull distribution is a generalization of the exponential % distribution.  If lifetimes follow an exponential distribution, then they % have a constant hazard rate.  This means that they do not age, in the % sense that the probability of observing a failure in an interval, given % survival to the start of that interval, doesn't depend on where the % interval starts.  A Weibull distribution has a hazard rate that may % increase or decrease. % % Other distributions used for modeling lifetime data include the % lognormal, gamma, and Birnbaum-Saunders distributions. % % We will plot the empirical cumulative distribution function of our data, % showing the proportion failing up to each possible survival time.  The % dotted curves give 95% confidence intervals for these probabilities. subplot(1,1,1); [empF,x,empFlo,empFup] = ecdf(obstime,'censoring',censored); stairs(x,empF); hold on; stairs(x,empFlo,':'); stairs(x,empFup,':'); hold off xlabel('Time'); ylabel('Proportion failed'); title('Empirical CDF')  %% % This plot shows, for instance, that the proportion failing by time 4,000 % is about 12%, and a 95% confidence bound for the probability of failure % by this time is from 6% to 18%.  Notice that because our test only ran % 14,000 hours, the empirical CDF only allows us to compute failure % probabilities out to that limit.  Almost half of the data were censored at % 14,000, and so the empirical CDF only rises to about 0.53, instead of % 1.0. % % The Weibull distribution is often a good model for equipment failure. The % function |wblfit| fits the Weibull distribution to data, including data % with censoring.  After computing parameter estimates, we'll evaluate the % CDF for the fitted Weibull model, using those estimates.  Because the CDF % values are based on estimated parameters, we'll compute confidence bounds % for them. paramEsts = wblfit(obstime,'censoring',censored); [nlogl,paramCov] = wbllike(paramEsts,obstime,censored); xx = linspace(1,2*T,500); [wblF,wblFlo,wblFup] = wblcdf(xx,paramEsts(1),paramEsts(2),paramCov);  %% % We can superimpose plots of the empirical CDF and the fitted CDF, to % judge how well the Weibull distribution models the throttle reliability % data. stairs(x,empF); hold on handles = plot(xx,wblF,'r-',xx,wblFlo,'r:',xx,wblFup,'r:'); hold off xlabel('Time'); ylabel('Fitted failure probability'); title('Weibull Model vs. Empirical')  %% % Notice that the Weibull model allows us to project out and compute % failure probabilities for times beyond the end of the test.  However, it % appears the fitted curve does not match our data well.  We have too many % early failures before time 2,000 compared with what the Weibull model % would predict, and as a result, too few for times between about 7,000 and % about 13,000.  This is not surprising REPLACE_WITH_DASH_DASH recall that we generated data % with just this sort of behavior.  %% Adding a Smooth Nonparametric Estimate % The pre-defined functions provided with the Statistics Toolbox don't % include any distributions that have an excess of early failures like % this.  Instead, we might want to draw a smooth, nonparametric curve % through the empirical CDF, using the function |ksdensity|.  We'll remove % the confidence bands for the Weibull CDF, and add two curves, one with % the default smoothing parameter, and one with a smoothing parameter 1/3 % the default value.  The smaller smoothing parameter makes the curve % follow the data more closely. delete(handles(2:end)) [npF,ignore,u] = ksdensity(obstime,xx,'cens',censored,'function','cdf'); line(xx,npF,'Color','g'); npF3 = ksdensity(obstime,xx,'cens',censored,'function','cdf','width',u/3); line(xx,npF3,'Color','m'); xlim([0 1.3*T]) title('Weibull and Nonparametric Models vs. Empirical') legend('Empirical','Fitted Weibull','Nonparametric, default','Nonparametric, 1/3 default', ...        'location','northwest');  %% % The nonparametric estimate with the smaller smoothing parameter matches the % data well.  However, just as for the empirical CDF, it is not possible % to extrapolate the nonparametric model beyond the end of the test REPLACE_WITH_DASH_DASH the % estimated CDF levels off above the last observation. % % Let's compute the hazard rate for this nonparametric fit and plot it over % the range of the data. hazrate = ksdensity(obstime,xx,'cens',censored,'width',u/3) ./ (1-npF3); plot(xx,hazrate) title('Hazard Rate for Nonparametric Model') xlim([0 T])  %% % This curve has a bit of a "bathtub" shape, with a hazard rate that is % high near 2,000, drops to lower values, then rises again.  This is typical % of the hazard rate for a component that is more susceptible to failure % early in its life (infant mortality), and again later in its life % (aging). % % Also notice that the hazard rate cannot be estimated above the largest % uncensored observation for the nonparametric model, and the graph drops % to zero.  %% Alternative Models % For the simulated data we've used for this example, we found that a % Weibull distribution was not a suitable fit.  We were able to fit the % data well with a nonparametric fit, but that model was only useful within % the range of the data. % % One alternative would be to use a different parametric distribution.  The % Statistics Toolbox includes functions for other common lifetime % distributions such as the lognormal, gamma, and Birnbaum-Saunders, as well % as many other distributions that are not commonly used in lifetime % models.  You can also define and fit custom parametric models to lifetime % data, as described in the <customdist2demo.html Fitting Custom Univariate % Distributions, Part 2> demo. % % Another alternative would be to use a mixture of two parametric % distributions REPLACE_WITH_DASH_DASH one representing early failure and the other % representing the rest of the distribution.  Fitting mixtures of % distributions is described in the <customdist1demo.html Fitting Custom % Univariate Distributions> demo.   displayEndOfDemoMessage(mfilename)  ##### SOURCE END ##### --></body></html>